# 기본편
- Airflow 파이프라인은 DAG 파일에 파이썬 코드로 DAG를 정의함.
- 각 DAG 파일은 서로 다른 Task와 해당 의존성을 기술하는 하나의 DAG에 대해 정의하고 Airflow가 실행되는 시기와 주기도 정의함.
- 백필(backfilling): 하나의 플로(Airflow는 DAG)를 특정 옵션(기간) 기준으로 다시 실행할 수 있는 기능. 태스크가 며칠 동안 실패하거나 새롭게 만든 플로를 과거의 특정 시점부터 순차적으로 실행하고 싶을 때 수행함.
  - Airflow 3가지 구성 요소
  - Airflow Scheduler: DAG를 분석하고 현재 시점에서 DAG의 스케줄이 지난 경우 Airflow 워커에 DAG의 Task를 예약함.
  - Airflow Worker: 예약된 태스크를 실행함.
  - Airflow Web Server: 스케줄러에서 분석한 DAG를 시각화하고 DAG 실행과 결과를 확인할 수 있는 주요 인터페이스를 제공함.
- Airflow Scherduler 작업 진행 단계
  1. 사용자가 DAG 워크플로를 작성하면, 스케줄러는 DAG 파일을 분석하고 각 DAG Task, 의존성 및 예약 주기를 확인함.
  2. 스케줄러는 마지막 DAG까지 내용을 확인한 후, DAG의 예약 주기가 경과했는지 확인함. 예약 주기가 현재 시간 이전이면 실행되도록 예약함.
  3. 예약된 각 Task에 대해 스케줄러는 해당 Task의 의존성(=업스트림 태스크)을 확인함. 의존성 Task가 완료되지 않았다면 실행 대기열에 추가함
  4. 스케줄러는 1단계로 다시 돌아간 후, 새로운 루프를 잠시동안 대기함.
- Airflow는 태스크 실패 시에 재시도(재실행 시간의 간격 설정도 가능) 할 수 있기 때문에 오류 발생 시에 태스크를 복구할 수 있다.
- Airflow의 스케줄 기능 중 강력한 것은 DAG에 정의된 특정 시점에 트리거할 수 있을 뿐만 아니라 최종 시점과 예상되는 다음 스케줄 주기를 상세하게 알려주는 것이다.
    - 이를 통해, 각각의 주기로 나누고 각 주기별로 DAG를 실행할 수 있음.
- 스케줄 주기를 백필 개념과 결합하여 새로 생성한 DAG를 과거 시점 및 기간에 대해 실행이 가능함.
    - 이 기능을 통해, 과거 특정 기간에 대해 DAG를 실행해 새로운 데이터 세트를 생성할 수 있음.
    - 과거 실행 결과를 삭제한 후, 태스크 코드를 변경한 후에 삭제된 과거 태스크를 재실행 가능함.
- Airflow를 선택하는 이유
  - Airflow가 배치 지향 데이터 파이프라인을 구현하는 데 적합함
    - 파이썬 기반의 Airflow는 쉽게 확장 가능하고 다양한 시스템과 통합이 가능함.
    - 파이썬 언어에서 구현할 수 있는 대부분의 방법을 사용하여 복잡한 커스텀 파이프라인 구현 가능
    - 수많은 스케줄링 기법이 파이프라인을 정기적으로 실행하고 점진적(증분) 처리를 통해, 전체 파이프라인을 재실행할 필요 없는 효율적인 파이프라인 구축 가능
    - 백필 기능을 사용해 과거 데이터를 손쉽게 재처리 가능하기 때문에 코드를 변경한 후, 데이터 재생성이 가능
    - Airflow의 훌륭한 웹 UI가 파이프라인 실행 결과를 모니터링 할 수 있고 오류를 디버깅하기 위한 훌륭한 뷰를 제공해줌.
- Airflow가 적합하지 않은 경우
  - 스트리밍 워크플로 및 해당 파이프라인 처리에 부적합
  - 추가 및 삭제 태스크가 빈번한 동적 파이프라인에 부적합함. 웹 인터페이스는 DAG의 가장 최근 실행 버전에 대한 정의만 표현해주기 때문에
  - 파이썬 경험이 없는 팀
  - 파이썬 코드가 복잡해질 수 있으므로 초기 사용 시점부터 엄격한 관리 필요함

### Chapter2. Airflow DAG 구조
- DAG 클래스는 2개의 인수가 필요
    - Airflow UI에 표시되는 DAG 이름
    - 워크플로가 처음 실행되는 날짜/시간
- 각 오퍼레이터는 하나의 태스크를 수행하고 여러개의 오퍼레이터가 Airflow의 워크플로 또는 DAG를 구성함
- 오퍼레이터는 서로 독립적으로 실행 가능하나 순서를 정의해 실행할 수도 있고 이를 의존성이라고 부름
